<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<title>tet slick grid demo</title>

<script src="../../jquery31/js/jquery.js"></script>

<link rel="stylesheet" type="text/css" href="../../accord/css/accord.css">
<link rel="stylesheet" type="text/css" href="../../accord/css/tabbed-panel.css">
<script type="module" src="../../accord/js/accord-publish.js"></script>

<link rel="stylesheet" href="../css/tet.slick.grid.css" type="text/css" />
<link rel="stylesheet" href="tsgDemoStyles.css" />
<script type="text/javascript" src="testDataSources.js"></script>
<script type="module" src="tsgExample60.js"></script>
<script>
  $(function() {
    let tp = new TabbedPanel("#tabbedPanel1");
  });
</script>

</head>

<body>
	<div class="basePanel">
		<div class="titlePanel">
			<h2>Пример: Получение строк из сервера (из сервлета)</h2>
			<a href="tsgExample60.js" target="source">Source code</a>

		</div>

		<div id="tabbedPanel1" class="tabbed-panel">

			<div class="tab-container">
				<button class="tab active" data-tab="1">Описание</button>
				<button class="tab" data-tab="2">Ключевой код</button>
				<button class="tab" data-tab="3">Серверный код</button>
				<div class="tab-filler"></div>
			</div>

			<div id="tab-1" class="tab-content active">
				<pre class="acc-desc-panel">
В данном примере данные загружаются постранично с сервера (с сервлета TSGDemoServlet1).
Предоставляет данные класс TSGTasksDao. Сортировку и фильтрацию выполняет класс TsgLocalDaoUtils.
Для того, чтобы загрузка шла с сервера, мы не задаём данные при создании таблицы.
Но при этом задаём url для работы с сервером: pageUrl, updateFilterUrl, clearFilterUrl.
По умолчанию данные отправляются в формате "x-www-form-urlencoded". Чтобы они отправлялись как json мы задаём опцию postFormDataAsJson.
</pre>
			</div>

			<div id="tab-2" class="tab-content">
				<pre class="acc-code-panel">
let options = {
	multiRowSelectionModel: true,
	explicitInitialization: true,
	showTitleHeader: true,
	enableHeaderRowFilters: true,
	withColumnDialog: true,
	withGridMenu: true,

	//url для получения страницы данных
	pageUrl: "/accord/tsg/getTasksJson/",
	//url для отправки условий фильтрации на сервер
	updateFilterUrl: "/accord/tsg/updateTasksFilter/",
	//url для очистки условий фильтрации на сервере
	clearFilterUrl: "/accord/tsg/clearTasksFilter/",

	//при инициализации таблицы будет очищать текущий фильтр на сервере, вызывая метод dataLoader.clearFilters(); 
	clearFilterAtInit: true,

	//отправлять данные формы через updateFilterUrl в формате Json.
	//По умолчанию используется формат "application/x-www-form-urlencoded"
	postFormDataAsJson: true
};



myGrid = new TetSlickGrid("#myGrid", null, columns, options);
myGrid.init();
				
</pre>
			</div>

			<div id="tab-3" class="tab-content">
				<pre class="acc-code-panel">
@WebServlet("/tsg/*")
public class TSGDemoServlet1 extends HttpServlet {
	...	
	TSGTasksDao dao;
	...	
	
	@Override
	protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		
		String pathInfo = req.getPathInfo();
		if (pathInfo.startsWith(UPDATE_FILTER_URL)) {
			
			TSGTaskFilter filter;
			if ("application/json".equals(req.getContentType())) {
				ObjectMapper mapper = new ObjectMapper();
				filter = mapper.readValue(req.getInputStream(), TSGTaskFilter.class);
			}
			...	
			req.getSession().setAttribute(FILTER, filter);
			
		} else if (pathInfo.startsWith(CLEAR_FILTER_URL)) {
			req.getSession().removeAttribute(FILTER);
		}
		...	
	}
	
	
	@Override
	protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		
		// "/getCustomerRequestJson/10/20"
		String pathInfo = req.getPathInfo();
		
		String[] parts = pathInfo.split("/");
		...	
		
		try {
			Integer startRow = Integer.parseInt(parts[2]);
			Integer pageSize = Integer.parseInt(parts[3]);

			TSGTaskFilter filter = (TSGTaskFilter)req.getSession().getAttribute(FILTER);
			if (filter==null) {
				filter = new TSGTaskFilter();
			}
			
			filter.setStartRow(startRow);
			filter.setPageSize(pageSize);

			SUPage<TSGTaskRow> page = dao.findRows(filter);
			
			// Установка типа ответа
			resp.setContentType("application/json");
			
			ObjectMapper mapper = new ObjectMapper();
			mapper.writeValue(resp.getOutputStream(), page);
			
		} catch (Exception e) {
			resp.setStatus(HttpServletResponse.SC_BAD_REQUEST);
			resp.getWriter().write("error:" + e.getMessage());
			e.printStackTrace();
		}
	}

}</pre>
			</div>

		</div>

		<div class="tablePanel">
			<div id="myGrid"></div>
		</div>

		<div id="filterContainer" style="display: none;">
			<select name="section">
				<option value="" selected="selected">-</option>
				<option value="0">Отдел №0</option>
				<option value="1">Отдел №1</option>
				<option value="2">Отдел №2</option>
				<option value="3">Отдел №3</option>
				<option value="4">Отдел №4</option>
				<option value="5">Отдел №5</option>
				<option value="6">Отдел №6</option>
				<option value="7">Отдел №7</option>
				<option value="8">Отдел №8</option>
				<option value="9">Отдел №9</option>
				<option value="10">Отдел №10</option>
				<option value="11">Отдел №11</option>
				<option value="12">Отдел №12</option>
				<option value="13">Отдел №13</option>
			</select>


		</div>


	</div>

</body>
</html>












